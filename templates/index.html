<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="{{ url_for('static', filename='HS_Trava_Favicon.png') }}">
    <title>HS_Trava</title>
</head>

<body>

    <div class="header-container">
        <div class="header-link"><h5><a href="/">home</a></h5></div>
        <div class="header-link"><h5><a href="/indexpage">dashboard</a></h5></div>
        <div class="header-link right-align"><h5><a href = "/login">login</a></h5></div>
    </div>

    <div class="dropdown-selector">
        <form action="/make_chart" method="POST" id="chartForm">
    
            <label for="timeframe">Time Frame:</label>
            <select name="timeframe" id="timeframe">
                <option value="last_5">Last 5 Activities</option>
                <option value="last_week">Last Week</option>
                <option value="last_month">Last Month</option>
                <option value="ytd">Year to Date</option>
                <option value="last_year">Last Year</option>
            </select>
    
            <label for="activity_type">Activity Type:</label>
            <select name="activity_type" id="activity_type">
                <option value="run">Running</option>
                <option value="bike">Biking</option>
            </select>
    
            <label for="metric">Metric:</label>
            <select name="metric" id="metric">
                <option value="distance">distance</option>
                <option value="elapsed_time">elapsed time</option>
                <option value="kudos_count">kudos count</option>
                <option value="average_speed">average speed</option>
                <option value="max_speed">max speed</option>
            </select>
    
            <label for="activity_sum">Sum data?:</label>
            <select name="activity_sum" id="activity_sum">
                <option value="1">Yes</option>
                <option value="0">No</option>
            </select>
    
            <button type="submit">Create Visualization</button>
    
        </form>
    </div>

    <div class="chart-builder">

        <div class="quick-panel">
            <h2>Quick viz</h2>
            <a href="#" onclick="updateChart('distance', 'run', 'last_5', 0)">Last 5 Runs</a> <p></p>
            <a href="#" onclick="updateChart('distance', 'bike', 'last_5', 0)">Last 5 Rides</a> <p></p>
            <a href="#" onclick="updateChart('distance', 'run', 'last_month', 0)">Monthly Running</a> <p></p>
            <a href="#" onclick="updateChart('distance', 'bike', 'last_month', 0)">Monthly Biking</a> <p></p>
            <a href="#" onclick="updateChart('distance', 'run', 'ytd', 0)">YTD Running</a> <p></p>
            <a href="#" onclick="updateChart('distance', 'bike', 'ytd', 0)">YTD Biking</a>
        </div>



        <div class="user-canvas">
            <canvas id="myChart"></canvas>
            <script>
                function updateChart(event) {
                    event.preventDefault(); // Prevent the form from submitting immediately
                    
                    const form = document.getElementById('chartForm');
                    const formData = new FormData(form);
                    
                    fetch('/make_chart', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(Object.fromEntries(formData))
                    })
                    .then(response => response.json())
                    .then(chartData => {
                        const ctx = document.getElementById('myChart').getContext('2d');
                        const myChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: chartData.activities,
                                datasets: [{
                                    label: 'My Activity Data',
                                    data: chartData.metrics,
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.dataset.label || '';
                                                if (label) {
                                                    return label + ': ' + context.parsed.y;
                                                }
                                                return '';
                                            },
                                            title: function(context) {
                                                // Set the hover status to display name on hover
                                                const dataIndex = context.dataIndex;
                                                return chartData.names[dataIndex];
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => console.error('Error fetching data:', error));                
                }
                
                document.getElementById('chartForm').addEventListener('submit', updateChart);            </script> 
        </div>

    </div>

    <div class="footer-block">
        <div class="left-footer-content">
        <img src="{{ url_for('static', filename='api_logo_pwrdBy_strava_horiz_light.png') }}" class="image" />
        </div>

        <div class="right-footer-content">
        <p><span style="color:#042237;">created by Harris Seabold for HCI 584 at Iowa State University</span></p>
        </div>
    </div>

</body>
</html>